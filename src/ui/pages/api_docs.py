import streamlit as st
import pandas as pd
import os


cwd = os.getcwd()

path_to_example = os.path.join(cwd, "src", "examples", "example_1.csv")

st.title("üõ† –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Horizon API")

st.markdown("""
### –û–ø–∏—Å–∞–Ω–∏–µ

### üìà POST https://nikitasavvin2000-horizon-api-921e.twc1.net/horizon_api

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

---

## üìù –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ DataFrame. –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö, —Ä–∞—Å—à–∏—Ä—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Ç–æ—á–∫–∏ –≤ –±—É–¥—É—â–µ–º –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

---

""")

df = pd.read_csv(path_to_example)

st.write(f"## –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞")

st.write(df)

st.markdown("""
## üì• –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å JSON-–æ–±—ä–µ–∫—Ç–æ–º —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

```json
{
  "df": [...],
  "time_column": "time",
  "col_target": "load_consumption",
  "forecast_horizon_time": "2022-09-10 05:55:00"
}
```

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----|----------|
| `df` | `List[Dict]` | ‚úÖ | –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤–∞—Ä–µ–π (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç `DataFrame.to_dict(orient="records")`). |
| `time_column` | `str` | ‚úÖ | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏. |
| `col_target` | `str` | ‚úÖ | –ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –ø–æ –∫–æ—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∏—Ç—Å—è –ø—Ä–æ–≥–Ω–æ–∑. |
| `forecast_horizon_time` | `str` (–≤ —Ñ–æ—Ä–º–∞—Ç–µ `YYYY-MM-DD HH:MM:SS`) | ‚úÖ | –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞, –¥–æ –∫–æ—Ç–æ—Ä–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è. |

---

## üì§ –û—Ç–≤–µ—Ç

–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (`200 OK`) —Å–æ–¥–µ—Ä–∂–∏—Ç JSON-–æ–±—ä–µ–∫—Ç —Å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏.

```json
{
  "predictions": [
    {"time": "2022-09-10 05:10:00", "load_consumption": 123.45},
    {"time": "2022-09-10 05:15:00", "load_consumption": 124.01},
    ...
  ]
}
```

---

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| `502` | –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–±–ª–µ–º–∞ —Å–µ—Ç–∏). |
| `500` | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-Error`. |

---

## üß™ –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ –Ω–∞ Python

```python
import requests
import pandas as pd

def func_generate_forecast(df: pd.DataFrame, time_column: str, col_target: str, forecast_horizon_time: str):
    url = "http://your_backend_url/backend/v1/generate_forecast"

    df_records = df.to_dict(orient='records')

    data = {
        "df": df_records,
        "time_column": time_column,
        "col_target": col_target,
        "forecast_horizon_time": forecast_horizon_time
    }

    try:
        response = requests.post(url, json=data)

        if response.status_code == 200:
            return response.json()
        else:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ: {response.status_code}")
            return None
    except requests.exceptions.RequestException as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ: {e}")
        return None

df = pd.read_csv("<your_data.csv>")
df["time"] = pd.to_datetime(df["time"])

response = func_generate_forecast(
    df=df,
    time_column="time",
    col_target="load_consumption",
    forecast_horizon_time="2022-09-10 05:00:00"
)
```

## üß© –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `time_column` –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏.
- –§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º —Å ISO 8601: `YYYY-MM-DD HH:MM:SS`.
- –ü—Ä–æ–≥–Ω–æ–∑ –±—É–¥–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–æ—á–∫–∏ –≤ `df` –¥–æ `forecast_horizon_time`.

""")